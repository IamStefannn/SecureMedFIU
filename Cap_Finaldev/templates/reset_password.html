<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reset Password - SecureMed</title>
<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #eef0ff;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
}
.container {
  background: #fff;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 6px 30px rgba(0,0,0,0.08);
  width: 400px;
}
h2 {
  text-align: center;
  color: #667eea;
  margin-bottom: 10px;
}
p {
  text-align: center;
  color: #6b7280;
  margin-bottom: 20px;
  font-size: 14px;
}
input {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-sizing: border-box;
}
button {
  width: 100%;
  padding: 12px;
  background: #667eea;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
}
button:hover {
  background: #5568d3;
}
.error {
  color: #e74c3c;
  text-align: center;
  margin: 10px 0;
}
.success {
  color: #10b981;
  text-align: center;
  margin: 10px 0;
  font-weight: 600;
}
.back-link {
  text-align: center;
  margin-top: 15px;
}
.back-link a {
  color: #667eea;
  text-decoration: none;
}
.back-link a:hover {
  text-decoration: underline;
}
.requirements {
  background: #f9fafb;
  padding: 12px;
  border-radius: 6px;
  margin: 10px 0;
  font-size: 13px;
  color: #6b7280;
}
.requirements ul {
  margin: 5px 0 0 20px;
  padding: 0;
}

/* Password Strength Indicator */
.password-strength {
  margin: 10px 0;
}
.strength-bar-container {
  width: 100%;
  height: 8px;
  background: #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
  margin: 8px 0;
}
.strength-bar {
  height: 100%;
  transition: all 0.3s;
  border-radius: 4px;
}
.strength-text {
  font-size: 13px;
  font-weight: 600;
  margin: 5px 0;
}
.strength-weak { color: #ef4444; }
.strength-fair { color: #f59e0b; }
.strength-good { color: #3b82f6; }
.strength-strong { color: #10b981; }
.requirements-checklist {
  background: #f9fafb;
  padding: 12px;
  border-radius: 6px;
  margin: 10px 0;
  font-size: 13px;
}
.requirement-item {
  padding: 4px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}
.requirement-item.met {
  color: #10b981;
}
.requirement-item.unmet {
  color: #9ca3af;
}
.crack-time {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
  margin-top: 8px;
  font-style: italic;
}
</style>
</head>
<body>
<div class="container">
  <h2>üîí Reset Password</h2>
  <p>Enter your new password</p>
  
  {% if error %}
  <div class="error">{{ error }}</div>
  {% endif %}
  
  {% if success %}
  <div class="success">{{ success }}</div>
  <div class="back-link">
    <a href="/login">‚Üí Go to Login</a>
  </div>
  {% else %}
  <form method="POST">
    <input id="new_password" name="new_password" type="password" placeholder="New Password" required autofocus>

    <div class="password-strength" id="strengthIndicator" style="display: none;">
      <div class="strength-bar-container">
        <div class="strength-bar" id="strengthBar"></div>
      </div>
      <div class="strength-text" id="strengthText"></div>
      <div class="crack-time" id="crackTime"></div>
    </div>

    <div class="requirements-checklist">
      <strong>Password Requirements:</strong>
      <div class="requirement-item unmet" id="req-length">
        <span id="icon-length">‚óã</span>
        <span>At least 8 characters</span>
      </div>
      <div class="requirement-item unmet" id="req-upper">
        <span id="icon-upper">‚óã</span>
        <span>One uppercase letter</span>
      </div>
      <div class="requirement-item unmet" id="req-number">
        <span id="icon-number">‚óã</span>
        <span>One number</span>
      </div>
      <div class="requirement-item unmet" id="req-special">
        <span id="icon-special">‚óã</span>
        <span>One special character (!@#$%^&*)</span>
      </div>
    </div>

    <input name="confirm_password" type="password" placeholder="Confirm Password" required>
    <button type="submit">Reset Password</button>
  </form>

  <script>
    const passwordInput = document.getElementById('new_password');
    const strengthIndicator = document.getElementById('strengthIndicator');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const crackTime = document.getElementById('crackTime');

    passwordInput.addEventListener('input', function() {
      const password = this.value;

      if (password.length === 0) {
        strengthIndicator.style.display = 'none';
        return;
      }

      strengthIndicator.style.display = 'block';

      // Check requirements
      const hasLength = password.length >= 8;
      const hasUpper = /[A-Z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);

      updateRequirement('length', hasLength);
      updateRequirement('upper', hasUpper);
      updateRequirement('number', hasNumber);
      updateRequirement('special', hasSpecial);

      // Calculate strength
      let strength = 0;
      if (hasLength) strength++;
      if (hasUpper) strength++;
      if (hasNumber) strength++;
      if (hasSpecial) strength++;
      if (password.length >= 12) strength++;

      // Update strength bar and text
      const strengthLevels = [
        { width: '25%', color: '#ef4444', text: 'Weak', class: 'strength-weak', time: 'Instant to crack' },
        { width: '50%', color: '#f59e0b', text: 'Fair', class: 'strength-fair', time: 'Minutes to crack' },
        { width: '75%', color: '#3b82f6', text: 'Good', class: 'strength-good', time: 'Days to crack' },
        { width: '100%', color: '#10b981', text: 'Strong', class: 'strength-strong', time: 'Years to crack' },
        { width: '100%', color: '#10b981', text: 'Very Strong', class: 'strength-strong', time: 'Centuries to crack' }
      ];

      const level = strengthLevels[strength];
      strengthBar.style.width = level.width;
      strengthBar.style.background = level.color;
      strengthText.textContent = 'Password Strength: ' + level.text;
      strengthText.className = 'strength-text ' + level.class;
      crackTime.textContent = '‚è±Ô∏è Estimated time to crack: ' + level.time;
    });

    function updateRequirement(reqName, met) {
      const reqElement = document.getElementById('req-' + reqName);
      const iconElement = document.getElementById('icon-' + reqName);

      if (met) {
        reqElement.className = 'requirement-item met';
        iconElement.textContent = '‚úì';
      } else {
        reqElement.className = 'requirement-item unmet';
        iconElement.textContent = '‚óã';
      }
    }
  </script>
  
  <div class="back-link">
    <a href="/login">‚Üê Cancel</a>
  </div>
  {% endif %}
</div>
</body>
</html>