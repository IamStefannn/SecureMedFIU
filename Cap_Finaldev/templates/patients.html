<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Patient Management - SecureMed</title>
<style>
body{font-family:Arial,sans-serif;background:#eef0ff;padding:20px;}
.navbar{display:flex;justify-content:space-between;align-items:center;background:#667eea;color:white;padding:12px;border-radius:6px;}
button{padding:8px 12px;margin:4px;border:none;border-radius:8px;background:#667eea;color:white;cursor:pointer;}
.card{background:white;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.08);padding:16px;margin-top:20px;}
th,td{padding:10px;border-bottom:1px solid #ddd;}
th{background:#667eea;color:white;}
</style>
</head>
<body>
<div class="navbar">
  <div><strong>ðŸ‘¥ Patient Management</strong></div>
  <div id="nav-buttons">
    <!-- Dashboard button injected below if admin -->
    <a href="/logout"><button style="background:#e74c3c">Logout</button></a>
  </div>
</div>

<div class="card">
  <h3>Patient Records</h3>
  <table id="patients-table">
    <thead><tr><th>ID</th><th>MRN</th><th>Name</th><th>DOB</th><th>Email</th><th>Phone</th><th>Added</th></tr></thead>
    <tbody><tr><td colspan="7">Loading...</td></tr></tbody>
  </table>
</div>

<script>
// role injected by backend template engine:
const role = "{{ session.get('role','') }}"; // Flask injects role string
if(role === 'admin'){
  const btn=document.createElement('a');
  btn.href='/dashboard';
  btn.innerHTML='<button>â¬… Back to Dashboard</button>';
  document.getElementById('nav-buttons').prepend(btn);
}

async function loadPatients(){
  const r=await fetch('/api/patients');
  const data=await r.json();
  const tb=document.querySelector('#patients-table tbody');
  if(!data.length){tb.innerHTML='<tr><td colspan=7>No patients</td></tr>';return;}
  tb.innerHTML='';
  data.forEach(p=>{
    tb.innerHTML+=`<tr><td>${p.id}</td><td>${p.mrn}</td><td>${p.first_name} ${p.last_name}</td>
      <td>${p.date_of_birth}</td><td>${p.email||'N/A'}</td><td>${p.phone||'N/A'}</td><td>${p.created_at}</td></tr>`;
  });
}
loadPatients();
</script>
</body>
</html>
