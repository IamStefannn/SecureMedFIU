<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Vulnerabilities - SecureMed</title>
<style>
body{font-family:Arial,sans-serif;background:#eef0ff;padding:20px;}
h1{color:#667eea;}
button{padding:8px 12px;margin:5px;border:none;border-radius:8px;background:#667eea;color:white;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left;}
th{background:#667eea;color:white;cursor:pointer;user-select:none;}
.badge{padding:5px 8px;border-radius:6px;color:white;}
.Critical{background:#e74c3c}.High{background:#e67e22}.Medium{background:#f1c40f;color:black}.Low{background:#27ae60}
</style>
</head>
<body>
<h1>Vulnerabilities Overview</h1>
<div style="margin-bottom:10px;">
  <a href="/dashboard"><button>â¬… Back to Dashboard</button></a>
  <button onclick="loadVulns()">ðŸ”„ Refresh</button>
  <button onclick="seedVulns()">ðŸ§© Seed Vulnerabilities</button>
  <button onclick="seedHIPAA()">ðŸ“‹ Seed HIPAA Compliance</button>
</div>

<table id="vuln-table">
<thead>
<tr>
  <th onclick="sortTable('id')">ID</th>
  <th onclick="sortTable('type')">Type</th>
  <th onclick="sortTable('severity')">Severity</th>
  <th onclick="sortTable('hipaa')">HIPAA</th>
  <th onclick="sortTable('recommendation')">Recommendation</th>
</tr>
</thead>
<tbody><tr><td colspan="5">Loading...</td></tr></tbody>
</table>

<script>
let allData=[],sortOrder={id:1,type:1,severity:1,hipaa:1,recommendation:1};
async function seedVulns(){const r=await fetch('/api/seed_vulnerabilities',{method:'POST'});alert((await r.json()).message);loadVulns();}
async function seedHIPAA(){const r=await fetch('/api/seed_hipaa_compliance',{method:'POST'});const res=await r.json();alert(`${res.message}\n\nCategories:\n- Administrative: ${res.categories.Administrative}\n- Physical: ${res.categories.Physical}\n- Technical: ${res.categories.Technical}\n- Privacy: ${res.categories.Privacy}\n- Breach: ${res.categories.Breach}\n- Organizational: ${res.categories.Organizational}\n- Specific: ${res.categories.Specific}`);loadVulns();}
async function loadVulns(){
  const r=await fetch('/api/vulnerabilities');allData=await r.json();render(allData);
}
function render(data){
  const tb=document.querySelector('#vuln-table tbody');
  if(!data.length){tb.innerHTML='<tr><td colspan=5>No vulnerabilities</td></tr>';return;}
  tb.innerHTML='';
  data.forEach(v=>{
    tb.innerHTML+=`<tr><td>${v.id}</td><td>${v.type}</td>
      <td><span class="badge ${v.severity}">${v.severity}</span></td><td>${v.hipaa_section||''}</td><td>${v.recommendation}</td></tr>`;
  });
}
function sortTable(field){
  const keyMap={id:'id',type:'type',severity:'severity',hipaa:'hipaa_section',recommendation:'recommendation'};
  const key=keyMap[field];sortOrder[field]*=-1;
  const sorted=[...allData].sort((a,b)=>{
    let av=a[key]||'',bv=b[key]||'';if(typeof av==='string'){av=av.toLowerCase();bv=bv.toLowerCase();}
    if(av>bv)return sortOrder[field];if(av<bv)return -sortOrder[field];return 0;
  });
  render(sorted);
}
loadVulns();
</script>
</body>
</html>
