<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SecureMed Nurse Dashboard - React</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
  min-height: 100vh;
}

/* Professional Header */
.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 0;
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.2);
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 32px;
}
.header-title {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.header-title h1 {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.5px;
}
.header-title p {
  font-size: 13px;
  opacity: 0.9;
  font-weight: 400;
}

/* Enhanced Buttons */
.btn {
  padding: 11px 22px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 14px;
  margin: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  letter-spacing: 0.3px;
}
.btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.btn:active { transform: translateY(0); }
.btn-primary { background: #667eea; color: white; }
.btn-primary:hover { background: #5568d3; }
.btn-success { background: #10b981; color: white; }
.btn-success:hover { background: #059669; }
.btn-danger { background: #ef4444; color: white; }
.btn-danger:hover { background: #dc2626; }
.btn-info { background: #3b82f6; color: white; }
.btn-info:hover { background: #2563eb; }
.btn-warning { background: #f59e0b; color: white; }
.btn-warning:hover { background: #d97706; }

/* Professional Container */
.container {
  max-width: 1600px;
  margin: 0 auto;
  padding: 32px 48px;
}

/* Dashboard Grid Layout */
.dashboard-grid {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 28px;
  margin-bottom: 28px;
}

/* Sidebar Section */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* Stats Card */
.stats-card {
  background: white;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.06);
  border: 1px solid rgba(0,0,0,0.04);
}
.stats-card h3 {
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #6b7280;
  margin-bottom: 18px;
  font-weight: 700;
}
.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
  border-radius: 10px;
  margin-bottom: 10px;
  border: 1px solid #f3f4f6;
  transition: all 0.3s;
}
.stat-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
  border-color: #667eea;
}
.stat-item:last-child { margin-bottom: 0; }
.stat-label {
  font-size: 13px;
  color: #4b5563;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}
.stat-value {
  font-size: 22px;
  font-weight: 700;
  color: #667eea;
}

/* Quick Actions Card */
.quick-actions-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(102,126,234,0.25);
  color: white;
}
.quick-actions-card h3 {
  font-size: 15px;
  margin-bottom: 16px;
  font-weight: 700;
  opacity: 0.95;
}
.quick-action-btn {
  width: 100%;
  padding: 14px 16px;
  background: rgba(255,255,255,0.15);
  border: 2px solid rgba(255,255,255,0.2);
  color: white;
  border-radius: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: all 0.3s;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
}
.quick-action-btn:hover {
  background: rgba(255,255,255,0.25);
  border-color: rgba(255,255,255,0.4);
  transform: translateX(4px);
}
.quick-action-btn:last-child { margin-bottom: 0; }

/* Main Content Area */
.main-content {
  display: flex;
  flex-direction: column;
  gap: 28px;
}

/* Search Bar - Professional Design */
.search-section {
  background: white;
  padding: 18px 22px;
  border-radius: 14px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  margin-bottom: 0;
  border: 1px solid rgba(102, 126, 234, 0.1);
}
.search-wrapper {
  position: relative;
  max-width: 600px;
}
.search-input {
  width: 100%;
  padding: 16px 20px 16px 52px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-size: 15px;
  transition: all 0.3s;
  background: #f9fafb;
  font-weight: 500;
}
.search-input:focus {
  outline: none;
  border-color: #667eea;
  background: white;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}
.search-icon {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  color: #6b7280;
  pointer-events: none;
}
.search-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  max-height: 400px;
  overflow-y: auto;
  z-index: 1000;
  border: 1px solid #e5e7eb;
}
.search-result-item {
  padding: 14px 20px;
  border-bottom: 1px solid #f3f4f6;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 12px;
}
.search-result-item:hover {
  background: #f9fafb;
  padding-left: 24px;
}
.search-result-item:last-child { border-bottom: none; }
.search-result-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 14px;
  flex-shrink: 0;
}
.search-result-details {
  flex: 1;
}
.search-result-name {
  font-weight: 600;
  color: #1f2937;
  font-size: 14px;
  margin-bottom: 2px;
}
.search-result-meta {
  font-size: 12px;
  color: #6b7280;
}
.search-no-results {
  padding: 32px 20px;
  text-align: center;
  color: #6b7280;
  font-size: 14px;
}

/* Quick Navigation */
.quick-nav {
  display: flex;
  gap: 12px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}

/* Enhanced Cards */
.card {
  background: white;
  padding: 28px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.06);
  margin-bottom: 28px;
  border: 1px solid rgba(0,0,0,0.04);
  transition: all 0.3s;
}
.card:hover {
  box-shadow: 0 8px 30px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}
.card h2 {
  font-size: 22px;
  color: #1f2937;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #f3f4f6;
  font-weight: 700;
  letter-spacing: -0.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Professional Assignment Cards */
.assignment-card {
  border-left: 4px solid #667eea;
  padding: 20px;
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
  border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  transition: all 0.3s;
  border: 1px solid #e5e7eb;
  border-left: 4px solid #667eea;
}
.assignment-card:hover {
  box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
  transform: translateX(4px);
}
.assignment-card h4 {
  margin: 0 0 12px 0;
  color: #667eea;
  font-size: 16px;
  font-weight: 700;
}
.assignment-card p {
  margin: 6px 0;
  color: #4b5563;
  font-size: 14px;
  line-height: 1.6;
}

/* Professional Tables */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 16px;
}
th, td {
  padding: 16px;
  text-align: left;
}
th {
  background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  font-weight: 700;
  color: #1f2937;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid #e5e7eb;
}
th:first-child { border-top-left-radius: 8px; }
th:last-child { border-top-right-radius: 8px; }
td {
  border-bottom: 1px solid #f3f4f6;
  font-size: 14px;
  color: #374151;
}
tr:hover td {
  background: #f9fafb;
}
tr:last-child td:first-child { border-bottom-left-radius: 8px; }
tr:last-child td:last-child { border-bottom-right-radius: 8px; }

/* Modals */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}
.modal-content {
  background: white;
  padding: 36px;
  border-radius: 20px;
  max-width: 550px;
  width: 90%;
  box-shadow: 0 24px 60px rgba(0,0,0,0.3);
  animation: modalSlideIn 0.3s ease-out;
}
@keyframes modalSlideIn {
  from { transform: translateY(-50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.form-group { margin: 20px 0; }
.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #1f2937;
  font-size: 14px;
}
.form-group input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  font-size: 14px;
  transition: all 0.3s;
  background: #f9fafb;
}
.form-group input:focus {
  outline: none;
  border-color: #667eea;
  background: white;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

/* States */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #6b7280;
  font-size: 15px;
}
.loading { text-align: center; padding: 60px 20px; color: #6b7280; }

/* Input Groups */
.input-group { position: relative; }
.input-group input { padding-right: 40px; }
.eye-icon {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 18px;
  user-select: none;
  color: #6b7280;
  transition: color 0.3s;
}
.eye-icon:hover { color: #667eea; }

/* Loading Spinner */
.spinner-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 300px;
}
.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #e5e7eb;
  border-top: 4px solid #667eea;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: 16px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.spinner-text {
  color: #6b7280;
  font-size: 15px;
  font-weight: 600;
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
}
.loading-overlay .spinner-container {
  background: white;
  padding: 48px;
  border-radius: 20px;
  box-shadow: 0 24px 60px rgba(0,0,0,0.3);
  min-height: auto;
}

/* HIPAA Training/Compliance */
.training-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}
.training-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 28px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(102,126,234,0.25);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
.training-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 150px;
  height: 150px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
  transform: translate(40%, -40%);
}
.training-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 32px rgba(102,126,234,0.4);
}
.training-card h3 {
  margin: 0 0 10px 0;
  font-size: 19px;
  font-weight: 700;
  position: relative;
  z-index: 1;
}
.training-card p {
  margin: 0;
  opacity: 0.95;
  font-size: 14px;
  line-height: 1.6;
  position: relative;
  z-index: 1;
}
.reminder-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}
.reminder-card {
  background: white;
  border-left: 4px solid #667eea;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  transition: all 0.3s;
}
.reminder-card:hover {
  box-shadow: 0 4px 20px rgba(102,126,234,0.15);
  transform: translateX(4px);
}
.reminder-card h4 {
  margin: 0 0 10px 0;
  color: #1f2937;
  font-size: 16px;
  font-weight: 700;
}
.reminder-card p {
  margin: 0;
  color: #4b5563;
  font-size: 13px;
  line-height: 1.6;
}
.quiz-btn {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 16px rgba(16,185,129,0.3);
  font-size: 15px;
  letter-spacing: 0.3px;
}
.quiz-btn:hover {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(16,185,129,0.4);
}

/* Training Modal Styles */
.training-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  backdrop-filter: blur(8px);
  animation: fadeIn 0.3s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.training-modal-content {
  background: white;
  border-radius: 24px;
  max-width: 900px;
  width: 95%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 24px 80px rgba(0,0,0,0.4);
  animation: slideUp 0.4s ease-out;
}
@keyframes slideUp {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.training-modal-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 32px;
  color: white;
  border-radius: 24px 24px 0 0;
  position: relative;
}
.training-modal-header h2 {
  font-size: 28px;
  margin-bottom: 8px;
  font-weight: 700;
}
.training-modal-header p {
  opacity: 0.95;
  font-size: 15px;
}
.training-close-btn {
  position: absolute;
  top: 24px;
  right: 24px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  border: 2px solid rgba(255,255,255,0.3);
  color: white;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}
.training-close-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: rotate(90deg);
}
.training-modal-body {
  padding: 40px;
}
.training-progress-bar {
  background: #e5e7eb;
  height: 8px;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 32px;
}
.training-progress-fill {
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  height: 100%;
  transition: width 0.5s ease;
  border-radius: 8px;
}
.training-section {
  margin-bottom: 40px;
}
.training-section-title {
  font-size: 22px;
  color: #1f2937;
  margin-bottom: 16px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 12px;
}
.training-content {
  background: #f9fafb;
  padding: 24px;
  border-radius: 16px;
  border-left: 4px solid #667eea;
  line-height: 1.8;
  color: #374151;
  font-size: 15px;
  margin-bottom: 24px;
}
.training-content ul {
  margin: 12px 0;
  padding-left: 24px;
}
.training-content li {
  margin: 8px 0;
}
.training-content strong {
  color: #667eea;
  font-weight: 700;
}
.quiz-section {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  padding: 32px;
  border-radius: 20px;
  border: 2px solid #3b82f6;
  margin-top: 32px;
}
.quiz-title {
  font-size: 24px;
  color: #1e40af;
  margin-bottom: 24px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 12px;
}
.quiz-question {
  background: white;
  padding: 24px;
  border-radius: 16px;
  margin-bottom: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
.quiz-question-text {
  font-size: 17px;
  color: #1f2937;
  font-weight: 600;
  margin-bottom: 16px;
}
.quiz-options {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.quiz-option {
  padding: 16px 20px;
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.quiz-option:hover {
  background: #f3f4f6;
  border-color: #667eea;
  transform: translateX(4px);
}
.quiz-option.selected {
  background: #ede9fe;
  border-color: #667eea;
  font-weight: 600;
}
.quiz-option.correct {
  background: #d1fae5;
  border-color: #10b981;
  color: #065f46;
}
.quiz-option.incorrect {
  background: #fee2e2;
  border-color: #ef4444;
  color: #991b1b;
}
.quiz-feedback {
  margin-top: 16px;
  padding: 16px;
  border-radius: 12px;
  font-size: 14px;
  line-height: 1.6;
}
.quiz-feedback.correct {
  background: #d1fae5;
  color: #065f46;
  border: 2px solid #10b981;
}
.quiz-feedback.incorrect {
  background: #fee2e2;
  color: #991b1b;
  border: 2px solid #ef4444;
}
.training-nav-buttons {
  display: flex;
  gap: 16px;
  margin-top: 40px;
  padding-top: 32px;
  border-top: 2px solid #e5e7eb;
}
.training-nav-btn {
  flex: 1;
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.training-nav-btn.primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 16px rgba(102,126,234,0.3);
}
.training-nav-btn.primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(102,126,234,0.4);
}
.training-nav-btn.secondary {
  background: #f3f4f6;
  color: #4b5563;
}
.training-nav-btn.secondary:hover {
  background: #e5e7eb;
}
.training-nav-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.completion-celebration {
  text-align: center;
  padding: 48px 32px;
}
.completion-celebration .emoji {
  font-size: 80px;
  margin-bottom: 24px;
  animation: bounce 1s ease-in-out;
}
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}
.completion-celebration h2 {
  font-size: 32px;
  color: #1f2937;
  margin-bottom: 16px;
  font-weight: 700;
}
.completion-celebration p {
  font-size: 16px;
  color: #6b7280;
  margin-bottom: 32px;
}
.score-display {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  padding: 24px;
  border-radius: 16px;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 32px;
}
</style>
</head>
<body>
<div id="root"></div>

{% raw %}
<script type="text/babel">
const { useState, useEffect, useCallback } = React;

// Training Module Data
const trainingModules = {
  phi: {
    title: "PHI Protection & Privacy",
    emoji: "üîí",
    duration: "8 minutes",
    sections: [
      {
        title: "What is Protected Health Information (PHI)?",
        content: `PHI includes any information that can identify a patient and relates to their health condition, treatment, or payment. This includes:

‚Ä¢ Names, addresses, phone numbers, email addresses
‚Ä¢ Medical record numbers (MRN), Social Security numbers
‚Ä¢ Photos, fingerprints, voiceprints
‚Ä¢ Health conditions, diagnoses, treatment plans
‚Ä¢ Payment and billing information

<strong>Key Rule:</strong> If you can identify WHO the patient is from the information, it's PHI and must be protected.`
      },
      {
        title: "Minimum Necessary Standard",
        content: `Only access, use, or share the minimum amount of PHI required to complete your specific job task.

<strong>Examples:</strong>
‚Ä¢ ‚úÖ CORRECT: Accessing only the patient records you're actively treating
‚Ä¢ ‚ùå WRONG: Looking up celebrity patients out of curiosity
‚Ä¢ ‚úÖ CORRECT: Sharing diagnosis with the treating physician
‚Ä¢ ‚ùå WRONG: Discussing patient details in the cafeteria

<strong>Always ask:</strong> "Do I really need to know this to do my job right now?"`
      },
      {
        title: "Securing PHI - Practical Steps",
        content: `<strong>Physical Security:</strong>
‚Ä¢ Lock your workstation (Windows + L) when stepping away
‚Ä¢ Never leave printed PHI unattended
‚Ä¢ Shred documents containing PHI before disposal
‚Ä¢ Don't discuss patients in public areas (elevators, cafeteria)

<strong>Digital Security:</strong>
‚Ä¢ Use strong, unique passwords - never share your login
‚Ä¢ Log out completely at end of shift
‚Ä¢ Encrypt PHI before emailing (use approved secure email only)
‚Ä¢ Never photograph patient information with personal devices`
      }
    ],
    quiz: [
      {
        question: "Which of the following is NOT considered PHI?",
        options: [
          "A patient's medical record number (MRN)",
          "De-identified statistical health data without names",
          "A patient's diagnosis and treatment plan",
          "A patient's email address"
        ],
        correct: 1,
        explanation: "De-identified data that cannot identify specific individuals is not PHI. All other options contain identifying information."
      },
      {
        question: "You're treating a patient and need to send their records to a specialist. What should you do?",
        options: [
          "Send the entire medical record to be thorough",
          "Send only the relevant sections needed for the consultation",
          "Email it from your personal Gmail account",
          "Print it and hand-deliver it yourself"
        ],
        correct: 1,
        explanation: "The Minimum Necessary Standard requires sending only the specific information needed for the consultation, using approved secure methods."
      },
      {
        question: "Your friend asks about a mutual acquaintance who is a patient at your facility. You should:",
        options: [
          "Share general information since they're friends",
          "Refuse to confirm or deny the person is even a patient",
          "Tell them only if the patient is doing okay",
          "Ask your supervisor first"
        ],
        correct: 1,
        explanation: "You cannot acknowledge someone is a patient without their authorization. Even confirming someone is at the facility violates HIPAA."
      }
    ]
  },
  communication: {
    title: "Secure Communication",
    emoji: "üìû",
    duration: "10 minutes",
    sections: [
      {
        title: "Approved Communication Channels",
        content: `SecureMed has approved specific methods for transmitting PHI. <strong>ALWAYS use these approved channels:</strong>

‚Ä¢ <strong>Secure Fax:</strong> Only fax numbers in the approved Directory
‚Ä¢ <strong>Encrypted Email:</strong> @securemed.com addresses only (automatically encrypted)
‚Ä¢ <strong>Secure Messaging:</strong> In-system messaging with verification codes
‚Ä¢ <strong>Hospital Transfer:</strong> Approved transfer locations with proper protocols
‚Ä¢ <strong>Courier Service:</strong> Sealed envelopes to approved addresses

<strong>‚ùå NEVER use:</strong>
‚Ä¢ Personal email (Gmail, Yahoo, etc.)
‚Ä¢ Text messages (SMS) for PHI
‚Ä¢ Social media or messaging apps
‚Ä¢ Unencrypted fax machines
‚Ä¢ Public cloud services (Dropbox, Google Drive)`
      },
      {
        title: "Verify Before You Send - The STOP Method",
        content: `Before transmitting any PHI, use the STOP method:

<strong>S</strong> - <strong>Stop</strong> and confirm: Is this PHI? Does it need to be sent?
<strong>T</strong> - <strong>Target</strong> verification: Is the recipient authorized? Check the Directory!
<strong>O</strong> - <strong>Options</strong> review: Am I using an approved secure method?
<strong>P</strong> - <strong>Proceed</strong> safely: Double-check the destination before clicking Send

<strong>Real Example:</strong>
You need to fax patient records to "City Hospital Radiology"
‚Ä¢ ‚úÖ STOP: Yes, this is PHI and medically necessary
‚Ä¢ ‚úÖ TARGET: Look up City Hospital in Directory: (555) 723-4400
‚Ä¢ ‚úÖ OPTIONS: Using approved secure fax machine
‚Ä¢ ‚úÖ PROCEED: Dial (555) 723-4400 and send`
      },
      {
        title: "Handling Communication Errors",
        content: `If you accidentally send PHI to the wrong recipient:

<strong>Immediate Actions (within 5 minutes):</strong>
1. <strong>Contact the recipient</strong> - Call them immediately and request deletion
2. <strong>Report to supervisor</strong> - Inform your charge nurse/manager right away
3. <strong>Document the incident</strong> - Complete an incident report with details
4. <strong>Patient notification</strong> - Compliance team will determine if patient needs notification

<strong>Prevention Tips:</strong>
‚Ä¢ Always verify fax/email addresses twice
‚Ä¢ Use the "confirm recipient" feature when available
‚Ä¢ Avoid sending PHI when rushed or distracted
‚Ä¢ Have a colleague double-check critical transmissions`
      }
    ],
    quiz: [
      {
        question: "You need to email a patient's lab results to their primary care doctor. Which method is HIPAA-compliant?",
        options: [
          "Use your personal Gmail to send it quickly",
          "Use the hospital's secure @securemed.com email system",
          "Text message the doctor with the results",
          "Post it in a secure Facebook group for doctors"
        ],
        correct: 1,
        explanation: "Only the hospital's encrypted email system (@securemed.com) is approved for sending PHI. Personal email and messaging apps are never HIPAA-compliant."
      },
      {
        question: "Before faxing patient records, you should:",
        options: [
          "Just dial the number the doctor gave you verbally",
          "Look up the approved fax number in the Directory",
          "Ask a coworker if they know the number",
          "Google the hospital and use the number you find"
        ],
        correct: 1,
        explanation: "Always verify fax numbers using the approved Directory to ensure you're sending to authorized, secure destinations."
      },
      {
        question: "You accidentally emailed PHI to the wrong doctor. What should you do FIRST?",
        options: [
          "Hope they don't read it and do nothing",
          "Delete the email from your sent folder",
          "Immediately contact the recipient and request deletion, then report to your supervisor",
          "Wait to see if they respond before taking action"
        ],
        correct: 2,
        explanation: "Immediate action is required: contact the recipient to request deletion, then report to your supervisor right away. Time is critical in breach mitigation."
      }
    ]
  },
  breach: {
    title: "Breach Prevention & Response",
    emoji: "üõ°Ô∏è",
    duration: "7 minutes",
    sections: [
      {
        title: "What Constitutes a HIPAA Breach?",
        content: `A breach is unauthorized access, use, or disclosure of PHI that compromises security or privacy.

<strong>Common Breach Scenarios:</strong>
‚Ä¢ <strong>Unauthorized Access:</strong> Viewing patient records without a job-related reason
‚Ä¢ <strong>Improper Disposal:</strong> Throwing PHI in regular trash instead of shredding
‚Ä¢ <strong>Lost/Stolen Devices:</strong> Unencrypted laptop or phone with PHI
‚Ä¢ <strong>Misdirected Communication:</strong> Emailing/faxing PHI to wrong recipient
‚Ä¢ <strong>Verbal Disclosure:</strong> Discussing patients where others can overhear
‚Ä¢ <strong>Insider Snooping:</strong> Looking up records of family, friends, or celebrities

<strong>Not Every Incident is a Breach:</strong>
‚Ä¢ Accidental access by authorized staff who immediately exits
‚Ä¢ PHI disclosed to someone already authorized to receive it
‚Ä¢ De-identified information that can't identify individuals`
      },
      {
        title: "Recognizing Security Threats",
        content: `<strong>Phishing & Social Engineering:</strong>
Watch out for suspicious emails or calls requesting:
‚Ä¢ Login credentials or passwords
‚Ä¢ Patient information "for verification"
‚Ä¢ Clicking links to "update security settings"
‚Ä¢ Urgent requests bypassing normal procedures

<strong>Warning Signs:</strong>
‚Ä¢ Unexpected emails with urgent language ("Your account will be locked!")
‚Ä¢ Requests for information via unusual channels
‚Ä¢ Pressure to act quickly without verification
‚Ä¢ Spelling errors or strange sender addresses (microsft.com instead of microsoft.com)

<strong>When in Doubt:</strong>
1. Don't click links or provide information
2. Call the supposed sender using a known phone number
3. Report suspicious messages to IT Security
4. Never share your password with anyone, ever`
      },
      {
        title: "Reporting & Responding to Incidents",
        content: `<strong>You MUST report these incidents immediately:</strong>
‚Ä¢ Suspected unauthorized access to patient records
‚Ä¢ Lost or stolen devices containing PHI
‚Ä¢ Misdirected PHI communications
‚Ä¢ Suspected malware or security compromise
‚Ä¢ Overheard discussing PHI inappropriately
‚Ä¢ Any situation where PHI may have been exposed

<strong>How to Report (Choose One):</strong>
1. <strong>Immediate supervisor</strong> - Your charge nurse or manager
2. <strong>Compliance Hotline:</strong> 1-800-HIPAA-24 (available 24/7)
3. <strong>Email:</strong> compliance@securemed.com
4. <strong>IT Security:</strong> For technical issues (x5555)

<strong>What Happens Next:</strong>
‚Ä¢ Compliance team investigates within 24 hours
‚Ä¢ You may be interviewed about the incident
‚Ä¢ Mitigation steps are taken immediately
‚Ä¢ Patient notification if required by law
‚Ä¢ <strong>You will NOT be punished for honest mistakes reported promptly</strong>

<strong>Remember:</strong> Early reporting minimizes harm and shows you're following protocol. Hiding incidents makes everything worse!`
      }
    ],
    quiz: [
      {
        question: "Which of the following is definitely a HIPAA breach?",
        options: [
          "Accidentally opening a patient's chart but closing it immediately",
          "Looking up your friend's medical records out of curiosity",
          "Discussing treatment with the patient's authorized physician",
          "Accessing records for a patient you're actively treating"
        ],
        correct: 1,
        explanation: "Accessing records without a legitimate job-related need (like curiosity about a friend) is unauthorized access and a clear HIPAA violation."
      },
      {
        question: "You receive an urgent email claiming to be from IT asking you to verify your password to 'prevent account suspension.' You should:",
        options: [
          "Reply with your password since it's from IT",
          "Click the link to update your security settings",
          "Recognize this as phishing and report to IT Security without clicking anything",
          "Forward it to coworkers to warn them"
        ],
        correct: 2,
        explanation: "This is a classic phishing attempt. IT will never ask for your password via email. Report it to IT Security immediately without clicking any links."
      },
      {
        question: "You accidentally faxed patient records to the wrong clinic. Your best course of action is:",
        options: [
          "Don't report it - the other clinic is bound by HIPAA too",
          "Immediately call the wrong recipient, request destruction, and report to your supervisor",
          "Wait 24 hours to see if they call you about it",
          "Send another fax to the correct clinic and forget about it"
        ],
        correct: 1,
        explanation: "Immediate action is critical: contact the wrong recipient to request secure disposal, then report to your supervisor right away. Early reporting enables proper breach response."
      }
    ]
  }
};

// Loading Spinner Component
const LoadingSpinner = ({ message = "Loading..." }) => (
  <div className="spinner-container">
    <div className="spinner"></div>
    <div className="spinner-text">{message}</div>
  </div>
);

// Assignment Card Component
const AssignmentCard = ({ assignment, onComplete }) => (
  <div className="assignment-card">
    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'start'}}>
      <div style={{flex: 1}}>
        <h4>{assignment.description}</h4>
        <p><strong>Type:</strong> {assignment.task_type.toUpperCase()} | <strong>Assigned by:</strong> {assignment.assigned_by}</p>
        <p><strong>Patient MRN:</strong> {assignment.patient_mrn} | <strong>Created:</strong> {assignment.created_at}</p>
        <p style={{fontSize: '12px', color: '#9ca3af'}}>HIPAA ¬ß {assignment.hipaa_section}</p>
      </div>
      <div>
        <button className="btn btn-primary" onClick={() => onComplete(assignment)}>
          üìù Complete
        </button>
      </div>
    </div>
  </div>
);

// Assignment Modal Component
const AssignmentModal = ({ assignment, onClose, onSubmit }) => {
  const [value, setValue] = useState('');

  if (!assignment) return null;

  const getLabel = () => {
    const labels = {
      'fax': 'Enter fax number:',
      'email': 'Enter email address:',
      'transfer': 'Enter transfer location:',
      'courier': 'Enter delivery location:',
      'secure_msg': 'Enter secure message ID:'
    };
    return labels[assignment.task_type] || 'Enter value:';
  };

  const getPlaceholder = () => {
    const placeholders = {
      'fax': '555-XXXX',
      'email': 'email@example.com',
      'transfer': 'Building X, Room XXX',
      'courier': 'Building X, Office',
      'secure_msg': 'SM-XXXX'
    };
    return placeholders[assignment.task_type] || 'Enter answer';
  };

  const handleSubmit = () => {
    if (!value.trim()) {
      alert('Please enter a value');
      return;
    }
    onSubmit(assignment.id, value);
    setValue('');
  };

  return (
    <div className="modal" onClick={onClose}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <h3>Complete Assignment</h3>
        <p style={{color: '#6b7280', margin: '12px 0'}}>{assignment.description}</p>
        <div style={{background: '#fef3c7', padding: '12px', borderRadius: '8px', margin: '12px 0'}}>
          <strong>üí° Tip:</strong> Check the <a href="/directory" target="_blank" style={{color: '#667eea'}}>Directory</a> for approved destinations
        </div>
        <div className="form-group">
          <label>{getLabel()}</label>
          <input 
            type="text" 
            placeholder={getPlaceholder()}
            value={value}
            onChange={(e) => setValue(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && handleSubmit()}
          />
        </div>
        <p style={{fontSize: '13px', color: '#6b7280', margin: '8px 0'}}>
          ‚ö†Ô∏è Make sure to enter the correct value. Mistakes will be logged to admin!
        </p>
        <div style={{marginTop: '24px', display: 'flex', gap: '12px'}}>
          <button className="btn btn-success" onClick={handleSubmit} style={{flex: 1}}>
            ‚úÖ Submit
          </button>
          <button className="btn btn-danger" onClick={onClose} style={{flex: 1}}>
            ‚ùå Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

// Add Patient Modal Component
const AddPatientModal = ({ onClose, onSubmit }) => {
  const [formData, setFormData] = useState({
    first_name: '',
    last_name: '',
    date_of_birth: '',
    email: '',
    phone: '',
    address: '',
    ssn: ''
  });
  const [showSSN, setShowSSN] = useState(false);

  const handleSSNChange = (e) => {
    const value = e.target.value;
    setFormData({ ...formData, ssn: value });
  };

  const handleSubmit = () => {
    if (!formData.first_name || !formData.last_name || !formData.date_of_birth || !formData.ssn) {
      alert('Please fill in all required fields (First Name, Last Name, DOB, SSN)');
      return;
    }
    onSubmit(formData);
    setFormData({ first_name: '', last_name: '', date_of_birth: '', email: '', phone: '', address: '', ssn: '' });
  };

  const maskSSN = (ssn) => {
    if (!ssn) return '';
    return '*'.repeat(ssn.length);
  };

  return (
    <div className="modal" onClick={onClose}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <h3>‚ûï Add New Patient</h3>
        <p style={{color: '#6b7280', margin: '12px 0', fontSize: '14px'}}>MRN will be auto-generated</p>

        <div className="form-group">
          <label>First Name *</label>
          <input
            type="text"
            placeholder="John"
            value={formData.first_name}
            onChange={(e) => setFormData({ ...formData, first_name: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Last Name *</label>
          <input
            type="text"
            placeholder="Doe"
            value={formData.last_name}
            onChange={(e) => setFormData({ ...formData, last_name: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Date of Birth *</label>
          <input
            type="date"
            value={formData.date_of_birth}
            onChange={(e) => setFormData({ ...formData, date_of_birth: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Email</label>
          <input
            type="email"
            placeholder="john.doe@email.com"
            value={formData.email}
            onChange={(e) => setFormData({ ...formData, email: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Phone</label>
          <input
            type="tel"
            placeholder="555-0123"
            value={formData.phone}
            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Address</label>
          <input
            type="text"
            placeholder="123 Main St, City, State"
            value={formData.address}
            onChange={(e) => setFormData({ ...formData, address: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>SSN *</label>
          <div className="input-group">
            <input
              type="text"
              placeholder="123-45-6789"
              value={showSSN ? formData.ssn : maskSSN(formData.ssn)}
              onChange={handleSSNChange}
              maxLength="11"
            />
            <span
              className="eye-icon"
              onClick={() => setShowSSN(!showSSN)}
              title={showSSN ? "Hide SSN" : "Show SSN"}
            >
              {showSSN ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è'}
            </span>
          </div>
        </div>

        <div style={{marginTop: '24px', display: 'flex', gap: '12px'}}>
          <button className="btn btn-success" onClick={handleSubmit} style={{flex: 1}}>
            ‚úÖ Add Patient
          </button>
          <button className="btn btn-danger" onClick={onClose} style={{flex: 1}}>
            ‚ùå Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

// Edit Patient Modal Component
const EditPatientModal = ({ patient, onClose, onSubmit }) => {
  const [formData, setFormData] = useState({
    email: patient.email || '',
    phone: patient.phone || '',
    address: patient.address || ''
  });

  const handleSubmit = () => {
    onSubmit(patient.id, formData);
  };

  return (
    <div className="modal" onClick={onClose}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <h3>‚úèÔ∏è Edit Patient Information</h3>
        <p style={{color: '#6b7280', margin: '12px 0', fontSize: '14px'}}>
          <strong>{patient.first_name} {patient.last_name}</strong> (MRN: {patient.mrn})
        </p>
        <p style={{color: '#ef4444', margin: '12px 0', fontSize: '13px', background: '#fef2f2', padding: '8px', borderRadius: '6px'}}>
          ‚ö†Ô∏è <strong>Note:</strong> Only Email, Phone, and Address can be edited. MRN, Name, DOB, and SSN are protected.
        </p>

        <div className="form-group">
          <label>Email</label>
          <input
            type="email"
            placeholder="patient@email.com"
            value={formData.email}
            onChange={(e) => setFormData({ ...formData, email: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Phone</label>
          <input
            type="tel"
            placeholder="555-0123"
            value={formData.phone}
            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
          />
        </div>

        <div className="form-group">
          <label>Address</label>
          <input
            type="text"
            placeholder="123 Main St, City, State ZIP"
            value={formData.address}
            onChange={(e) => setFormData({ ...formData, address: e.target.value })}
          />
        </div>

        <div style={{marginTop: '24px', display: 'flex', gap: '12px'}}>
          <button className="btn btn-success" onClick={handleSubmit} style={{flex: 1}}>
            ‚úÖ Save Changes
          </button>
          <button className="btn btn-danger" onClick={onClose} style={{flex: 1}}>
            ‚ùå Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

// Training Modal Component
const TrainingModal = ({ module, onClose, completedModules, setCompletedModules, currentUsername }) => {
  const [currentSection, setCurrentSection] = useState(0);
  const [quizAnswers, setQuizAnswers] = useState({});
  const [showingQuiz, setShowingQuiz] = useState(false);
  const [quizSubmitted, setQuizSubmitted] = useState(false);
  const [score, setScore] = useState(0);

  if (!module) return null;

  const moduleData = trainingModules[module];
  const totalSections = moduleData.sections.length;
  const progress = showingQuiz ? 100 : ((currentSection + 1) / totalSections) * 100;

  const handleAnswerSelect = (questionIndex, optionIndex) => {
    setQuizAnswers({ ...quizAnswers, [questionIndex]: optionIndex });
  };

  const submitQuiz = async () => {
    // Disable button to prevent double submission
    const submitBtn = document.querySelector('.quiz-submit-btn');
    if (submitBtn) submitBtn.disabled = true;

    // Build answers array with all questions
    const answers = moduleData.quiz.map((q, idx) => ({
      scenario_type: `${module}_q${idx + 1}`,
      is_correct: quizAnswers[idx] === q.correct
    }));

    // Count correct for display
    const correctCount = answers.filter(a => a.is_correct).length;

    try {
      // Submit entire quiz in ONE API call
      const response = await fetch('/api/training/submit_quiz', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          module_name: module,
          answers: answers
        })
      });

      const result = await response.json();

      if (result.success) {
        // Update state from server response
        setCompletedModules(result.completed_modules || []);
        console.log('Quiz submitted successfully:', result);
      } else {
        console.error('Quiz submission failed:', result);
      }
    } catch (error) {
      console.error('Error submitting quiz:', error);
    }

    setScore(correctCount);
    setQuizSubmitted(true);

    // Reload page to show updated compliance score and completed modules
    setTimeout(() => {
      window.location.reload();
    }, 2000);
  };

  const renderContent = (content) => {
    const lines = content.split('\n');
    const elements = [];
    let ulItems = [];

    lines.forEach((line, idx) => {
      if (line.startsWith('‚Ä¢')) {
        ulItems.push(<li key={`li-${idx}`} dangerouslySetInnerHTML={{ __html: line.substring(1).trim() }} />);
      } else {
        if (ulItems.length > 0) {
          elements.push(<ul key={`ul-${idx}`} style={{marginLeft: '20px', marginBottom: '12px'}}>{ulItems}</ul>);
          ulItems = [];
        }
        if (line.trim()) {
          elements.push(<p key={`p-${idx}`} dangerouslySetInnerHTML={{ __html: line }} style={{margin: '12px 0'}} />);
        }
      }
    });

    if (ulItems.length > 0) {
      elements.push(<ul key="ul-final" style={{marginLeft: '20px', marginBottom: '12px'}}>{ulItems}</ul>);
    }

    return elements;
  };

  return (
    <div className="training-modal" onClick={onClose}>
      <div className="training-modal-content" onClick={(e) => e.stopPropagation()}>
        <div className="training-modal-header">
          <button className="training-close-btn" onClick={onClose}>‚úï</button>
          <div style={{fontSize: '48px', marginBottom: '12px'}}>{moduleData.emoji}</div>
          <h2>{moduleData.title}</h2>
          <p>Estimated time: {moduleData.duration} ‚Ä¢ Interactive training with quiz</p>
        </div>

        <div className="training-modal-body">
          {/* Progress Bar */}
          <div className="training-progress-bar">
            <div className="training-progress-fill" style={{width: `${progress}%`}}></div>
          </div>

          {!showingQuiz && !quizSubmitted && (
            <>
              {/* Current Section */}
              <div className="training-section">
                <div className="training-section-title">
                  <span>üìñ</span>
                  <span>Section {currentSection + 1} of {totalSections}: {moduleData.sections[currentSection].title}</span>
                </div>
                <div className="training-content">
                  {renderContent(moduleData.sections[currentSection].content)}
                </div>
              </div>

              {/* Navigation Buttons */}
              <div className="training-nav-buttons">
                {currentSection > 0 && (
                  <button className="training-nav-btn secondary" onClick={() => setCurrentSection(currentSection - 1)}>
                    ‚Üê Previous Section
                  </button>
                )}
                {currentSection < totalSections - 1 ? (
                  <button className="training-nav-btn primary" onClick={() => setCurrentSection(currentSection + 1)}>
                    Next Section ‚Üí
                  </button>
                ) : (
                  <button className="training-nav-btn primary" onClick={() => setShowingQuiz(true)}>
                    üìù Start Quiz ‚Üí
                  </button>
                )}
              </div>
            </>
          )}

          {showingQuiz && !quizSubmitted && (
            <>
              <div className="quiz-section">
                <div className="quiz-title">
                  <span>üìù</span>
                  <span>Knowledge Check Quiz</span>
                </div>
                <p style={{marginBottom: '24px', color: '#4b5563'}}>Answer all {moduleData.quiz.length} questions to complete the training. You need {moduleData.quiz.length >= 3 ? '2' : '1'} correct to pass.</p>

                {moduleData.quiz.map((q, qIdx) => (
                  <div key={qIdx} className="quiz-question">
                    <div className="quiz-question-text">
                      {qIdx + 1}. {q.question}
                    </div>
                    <div className="quiz-options">
                      {q.options.map((option, oIdx) => (
                        <div
                          key={oIdx}
                          className={`quiz-option ${quizAnswers[qIdx] === oIdx ? 'selected' : ''}`}
                          onClick={() => handleAnswerSelect(qIdx, oIdx)}
                        >
                          <span style={{fontWeight: '700', color: '#667eea'}}>{String.fromCharCode(65 + oIdx)}.</span>
                          <span>{option}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>

              <div className="training-nav-buttons">
                <button className="training-nav-btn secondary" onClick={() => setShowingQuiz(false)}>
                  ‚Üê Back to Training
                </button>
                <button
                  className="training-nav-btn primary quiz-submit-btn"
                  onClick={submitQuiz}
                  disabled={Object.keys(quizAnswers).length < moduleData.quiz.length}
                >
                  Submit Quiz ‚úì
                </button>
              </div>
            </>
          )}

          {quizSubmitted && (
            <>
              {score >= (moduleData.quiz.length >= 3 ? 2 : 1) ? (
                <div className="completion-celebration">
                  <div className="emoji">üéâ</div>
                  <h2>Congratulations!</h2>
                  <p>You've successfully completed the {moduleData.title} training module.</p>
                  <div className="score-display">
                    Your Score: {score} / {moduleData.quiz.length} Correct
                  </div>

                  {/* Show Quiz Results */}
                  <div style={{textAlign: 'left', marginTop: '32px'}}>
                    <h3 style={{marginBottom: '20px', color: '#1f2937'}}>Quiz Review:</h3>
                    {moduleData.quiz.map((q, qIdx) => {
                      const userAnswer = quizAnswers[qIdx];
                      const isCorrect = userAnswer === q.correct;
                      return (
                        <div key={qIdx} className="quiz-question">
                          <div className="quiz-question-text">
                            {qIdx + 1}. {q.question}
                          </div>
                          <div className="quiz-options">
                            {q.options.map((option, oIdx) => {
                              let className = 'quiz-option';
                              if (oIdx === q.correct) className += ' correct';
                              else if (oIdx === userAnswer && !isCorrect) className += ' incorrect';
                              return (
                                <div key={oIdx} className={className}>
                                  <span style={{fontWeight: '700'}}>{String.fromCharCode(65 + oIdx)}.</span>
                                  <span>{option}</span>
                                  {oIdx === q.correct && <span style={{marginLeft: 'auto'}}>‚úì</span>}
                                </div>
                              );
                            })}
                          </div>
                          <div className={`quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}`}>
                            {isCorrect ? '‚úì Correct!' : '‚úó Incorrect.'} {q.explanation}
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <button className="training-nav-btn primary" onClick={onClose} style={{marginTop: '32px', width: '100%'}}>
                    ‚úÖ Complete Training
                  </button>
                </div>
              ) : (
                <div className="completion-celebration">
                  <div className="emoji">üìö</div>
                  <h2>Please Review & Retry</h2>
                  <p>You need at least {moduleData.quiz.length >= 3 ? '2' : '1'} correct answers to pass.</p>
                  <div className="score-display" style={{background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'}}>
                    Your Score: {score} / {moduleData.quiz.length} Correct
                  </div>
                  <div className="training-nav-buttons">
                    <button className="training-nav-btn secondary" onClick={() => { setShowingQuiz(false); setQuizSubmitted(false); setCurrentSection(0); }}>
                      üìñ Review Training
                    </button>
                    <button className="training-nav-btn primary" onClick={() => { setQuizSubmitted(false); setQuizAnswers({}); }}>
                      üîÑ Retry Quiz
                    </button>
                  </div>
                </div>
              )}
            </>
          )}
        </div>
      </div>
    </div>
  );
};

// Main Nurse Dashboard Component
const NurseDashboard = () => {
  const [assignments, setAssignments] = useState([]);
  const [patients, setPatients] = useState([]);
  const [loading, setLoading] = useState(true);
  const [actionLoading, setActionLoading] = useState(false);
  const [selectedAssignment, setSelectedAssignment] = useState(null);
  const [showAddPatient, setShowAddPatient] = useState(false);
  const [editingPatient, setEditingPatient] = useState(null);
  const [username, setUsername] = useState('Nurse');
  const [searchQuery, setSearchQuery] = useState('');
  const [searchResults, setSearchResults] = useState([]);
  const [showSearchDropdown, setShowSearchDropdown] = useState(false);
  const [activeTraining, setActiveTraining] = useState(null);
  const [complianceScore, setComplianceScore] = useState(0);
  const [trainingCompleted, setTrainingCompleted] = useState(0);
  const currentUsername = "{{ username }}";  // Get username from backend
  const [completedModules, setCompletedModules] = useState([]);

  // Load assignments
  const loadAssignments = useCallback(async () => {
    try {
      const data = await fetch('/api/assignments').then(r => r.json());
      const pending = data.filter(a => a.status === 'Pending');
      setAssignments(pending);
    } catch (error) {
      console.error('Error loading assignments:', error);
    }
  }, []);

  // Load patients
  const loadPatients = useCallback(async () => {
    try {
      const data = await fetch('/api/patients').then(r => r.json());
      setPatients(data);
    } catch (error) {
      console.error('Error loading patients:', error);
    }
  }, []);

  // Load compliance score and completed modules from database
  const loadComplianceScore = useCallback(async () => {
    try {
      const data = await fetch('/api/training/score').then(r => r.json());
      setComplianceScore(data.compliance_score || 0);
      setTrainingCompleted(data.training_completed || 0);
      setCompletedModules(data.completed_modules || []);
    } catch (error) {
      console.error('Error loading compliance score:', error);
    }
  }, []);

  // Submit assignment
  const handleSubmitAssignment = async (assignmentId, userValue) => {
    setActionLoading(true);
    try {
      await fetch(`/api/assignments/${assignmentId}/complete`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({user_value: userValue})
      });

      // Silent submission - just close and reload
      setSelectedAssignment(null);
      await loadAssignments();
    } catch (error) {
      alert('Error submitting assignment: ' + error);
    } finally {
      setActionLoading(false);
    }
  };

  // Add patient
  const handleAddPatient = async (patientData) => {
    setActionLoading(true);
    try {
      const response = await fetch('/api/patients/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(patientData)
      });

      const result = await response.json();

      if (response.ok) {
        alert(`‚úÖ Patient added successfully! MRN: ${result.mrn}`);
        setShowAddPatient(false);
        await loadPatients();
      } else {
        alert('Error: ' + result.error);
      }
    } catch (error) {
      alert('Error adding patient: ' + error);
    } finally {
      setActionLoading(false);
    }
  };

  // Edit patient
  const handleEditPatient = async (patientId, updatedData) => {
    setActionLoading(true);
    try {
      const response = await fetch(`/api/patients/${patientId}/update`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(updatedData)
      });

      const result = await response.json();

      if (response.ok) {
        alert('‚úÖ Patient information updated successfully!');
        setEditingPatient(null);
        await loadPatients();
      } else {
        alert('Error: ' + result.error);
      }
    } catch (error) {
      alert('Error updating patient: ' + error);
    } finally {
      setActionLoading(false);
    }
  };

  // Handle search input
  const handleSearch = (query) => {
    setSearchQuery(query);

    if (query.trim().length < 2) {
      setSearchResults([]);
      setShowSearchDropdown(false);
      return;
    }

    const lowerQuery = query.toLowerCase();
    const results = patients.filter(p =>
      p.first_name.toLowerCase().includes(lowerQuery) ||
      p.last_name.toLowerCase().includes(lowerQuery) ||
      p.mrn.toLowerCase().includes(lowerQuery) ||
      (p.email && p.email.toLowerCase().includes(lowerQuery)) ||
      (p.phone && p.phone.toLowerCase().includes(lowerQuery))
    );

    setSearchResults(results);
    setShowSearchDropdown(results.length > 0);
  };

  // Handle search result click
  const handleSearchResultClick = (patient) => {
    alert(`üìã Patient Details\n\nMRN: ${patient.mrn}\nName: ${patient.first_name} ${patient.last_name}\nDOB: ${patient.date_of_birth}\nEmail: ${patient.email || 'N/A'}\nPhone: ${patient.phone || 'N/A'}\nAddress: ${patient.address || 'N/A'}\nAdded By: ${patient.created_by}`);
    setSearchQuery('');
    setShowSearchDropdown(false);
  };

  // Load all data on mount
  useEffect(() => {
    const loadAllData = async () => {
      setLoading(true);
      await Promise.all([loadAssignments(), loadPatients(), loadComplianceScore()]);
      setLoading(false);
    };
    loadAllData();
  }, [loadAssignments, loadPatients, loadComplianceScore]);

  if (loading) {
    return <LoadingSpinner message="Loading dashboard data..." />;
  }

  return (
    <>
      {actionLoading && (
        <div className="loading-overlay">
          <LoadingSpinner message="Processing..." />
        </div>
      )}
      <div className="header">
        <div className="header-content">
          <div className="header-title">
            <h1>üëã Hello, {username}!</h1>
            <p>SecureMed Patient Management</p>
          </div>
          <button className="btn btn-danger" onClick={() => window.location.href = '/logout'}>
            Logout
          </button>
        </div>
      </div>

      <div className="container">
        {/* Dashboard Grid Layout */}
        <div className="dashboard-grid">
          {/* Left Sidebar */}
          <div className="sidebar">
            {/* Stats Overview */}
            <div className="stats-card">
              <h3>üìä Overview</h3>
              <div className="stat-item">
                <span className="stat-label">üìã Assignments</span>
                <span className="stat-value">{assignments.length}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">üë• Patients</span>
                <span className="stat-value">{patients.length}</span>
              </div>
              <div className="stat-item">
                <span className="stat-label">‚úÖ Completed Today</span>
                <span className="stat-value">0</span>
              </div>
            </div>

            {/* Quick Actions */}
            <div className="quick-actions-card">
              <h3>‚ö° Quick Actions</h3>
              <button className="quick-action-btn" onClick={() => setShowAddPatient(true)}>
                <span>‚ûï</span> Add New Patient
              </button>
              <button className="quick-action-btn" onClick={() => window.location.href = '/directory'}>
                <span>üìñ</span> View Directory
              </button>
              <button className="quick-action-btn" onClick={() => window.location.href = '/my_violations'}>
                <span>üîí</span> HIPAA Violations
              </button>
              <button className="quick-action-btn" onClick={loadAssignments}>
                <span>üîÑ</span> Refresh Data
              </button>
            </div>

            {/* Compliance Badge */}
            <div style={{background: complianceScore >= 80 ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : complianceScore >= 50 ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', padding: '20px', borderRadius: '16px', boxShadow: '0 8px 24px rgba(16,185,129,0.25)', color: 'white', textAlign: 'center'}}>
              <div style={{fontSize: '32px', marginBottom: '8px'}}>{complianceScore >= 80 ? 'üèÜ' : complianceScore >= 50 ? '‚ö†Ô∏è' : '‚ùå'}</div>
              <div style={{fontSize: '16px', fontWeight: '700', marginBottom: '4px'}}>{complianceScore}% Compliant</div>
              <div style={{fontSize: '12px', opacity: '0.9'}}>{complianceScore >= 80 ? 'Excellent work!' : complianceScore >= 50 ? 'Needs improvement' : 'Training required'}</div>
            </div>
          </div>

          {/* Main Content Area */}
          <div className="main-content">
            {/* Patient Search Bar */}
            <div className="search-section">
              <div className="search-wrapper">
                <span className="search-icon">üîç</span>
                <input
                  type="text"
                  className="search-input"
                  placeholder="Search patients by name, MRN, email, or phone..."
                  value={searchQuery}
                  onChange={(e) => handleSearch(e.target.value)}
                  onFocus={() => searchResults.length > 0 && setShowSearchDropdown(true)}
                  onBlur={() => setTimeout(() => setShowSearchDropdown(false), 200)}
                />
                {showSearchDropdown && (
                  <div className="search-dropdown">
                    {searchResults.map(patient => (
                      <div
                        key={patient.id}
                        className="search-result-item"
                        onClick={() => handleSearchResultClick(patient)}
                      >
                        <div className="search-result-icon">
                          {patient.first_name.charAt(0)}{patient.last_name.charAt(0)}
                        </div>
                        <div className="search-result-details">
                          <div className="search-result-name">
                            {patient.first_name} {patient.last_name}
                          </div>
                          <div className="search-result-meta">
                            MRN: {patient.mrn} ‚Ä¢ DOB: {patient.date_of_birth} ‚Ä¢ Added by: {patient.created_by}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>

            {/* Assignments Section */}
            <div className="card">
              <h2>üìã My Assignments ({assignments.length})</h2>
              {assignments.length === 0 ? (
                <div className="empty-state">No pending assignments. Great job!</div>
              ) : (
                assignments.map(assignment => (
                  <AssignmentCard
                    key={assignment.id}
                    assignment={assignment}
                    onComplete={setSelectedAssignment}
                  />
                ))
              )}
            </div>

            {/* Patients Section */}
            <div className="card">
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                <h2 style={{margin: 0, paddingBottom: 0, borderBottom: 'none'}}>üë• Patient Management</h2>
                <button className="btn btn-success" onClick={() => setShowAddPatient(true)}>
                  ‚ûï Add Patient
                </button>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>MRN</th>
                    <th>Name</th>
                    <th>DOB</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Added By</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {patients.length === 0 ? (
                    <tr><td colSpan="8" className="empty-state">No patients found</td></tr>
                  ) : (
                    patients.map(p => (
                      <tr key={p.id}>
                        <td><strong>{p.mrn}</strong></td>
                        <td>{p.first_name} {p.last_name}</td>
                        <td>{p.date_of_birth}</td>
                        <td>{p.email || 'N/A'}</td>
                        <td>{p.phone || 'N/A'}</td>
                        <td>{p.address || 'N/A'}</td>
                        <td>{p.created_by}</td>
                        <td>
                          <button
                            className="btn btn-primary"
                            style={{padding: '4px 12px', fontSize: '13px'}}
                            onClick={() => setEditingPatient(p)}
                          >
                            ‚úèÔ∏è Edit
                          </button>
                        </td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>

            {/* HIPAA Training & Compliance Section */}
            <div className="card">
              <h2>üìö HIPAA Training & Compliance</h2>

        {/* Training Modules */}
        <div className="training-grid">
          <div className="training-card" style={completedModules.includes('phi') ? {opacity: '0.6', background: 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'} : {}}>
            <div style={{fontSize: '36px', marginBottom: '12px'}}>üîí</div>
            <h3 style={{margin: '0 0 8px 0', fontSize: '18px'}}>PHI Protection & Privacy</h3>
            <p style={{margin: '0 0 16px 0', fontSize: '14px', opacity: '0.9'}}>Learn how to properly handle Protected Health Information</p>
            <div style={{fontSize: '13px', opacity: '0.8', marginBottom: '16px'}}>‚è±Ô∏è 8 minutes ‚Ä¢ 3 sections ‚Ä¢ Quiz</div>
            <button
              onClick={() => !completedModules.includes('phi') && setActiveTraining('phi')}
              style={{width: '100%', padding: '12px', background: completedModules.includes('phi') ? '#059669' : 'rgba(255,255,255,0.2)', border: '2px solid rgba(255,255,255,0.3)', borderRadius: '8px', color: 'white', fontWeight: '700', cursor: completedModules.includes('phi') ? 'default' : 'pointer', fontSize: '14px'}}
            >
              {completedModules.includes('phi') ? '‚úì Completed' : '‚ñ∂Ô∏è Start Training'}
            </button>
          </div>

          <div className="training-card" style={completedModules.includes('communication') ? {opacity: '0.6', background: 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'} : {}}>
            <div style={{fontSize: '36px', marginBottom: '12px'}}>üìû</div>
            <h3 style={{margin: '0 0 8px 0', fontSize: '18px'}}>Secure Communication</h3>
            <p style={{margin: '0 0 16px 0', fontSize: '14px', opacity: '0.9'}}>Best practices for HIPAA-compliant communication</p>
            <div style={{fontSize: '13px', opacity: '0.8', marginBottom: '16px'}}>‚è±Ô∏è 10 minutes ‚Ä¢ 3 sections ‚Ä¢ Quiz</div>
            <button
              onClick={() => !completedModules.includes('communication') && setActiveTraining('communication')}
              style={{width: '100%', padding: '12px', background: completedModules.includes('communication') ? '#059669' : 'rgba(255,255,255,0.2)', border: '2px solid rgba(255,255,255,0.3)', borderRadius: '8px', color: 'white', fontWeight: '700', cursor: completedModules.includes('communication') ? 'default' : 'pointer', fontSize: '14px'}}
            >
              {completedModules.includes('communication') ? '‚úì Completed' : '‚ñ∂Ô∏è Start Training'}
            </button>
          </div>

          <div className="training-card" style={completedModules.includes('breach') ? {opacity: '0.6', background: 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'} : {}}>
            <div style={{fontSize: '36px', marginBottom: '12px'}}>üõ°Ô∏è</div>
            <h3 style={{margin: '0 0 8px 0', fontSize: '18px'}}>Breach Prevention & Response</h3>
            <p style={{margin: '0 0 16px 0', fontSize: '14px', opacity: '0.9'}}>Recognize threats and respond to security incidents</p>
            <div style={{fontSize: '13px', opacity: '0.8', marginBottom: '16px'}}>‚è±Ô∏è 7 minutes ‚Ä¢ 3 sections ‚Ä¢ Quiz</div>
            <button
              onClick={() => !completedModules.includes('breach') && setActiveTraining('breach')}
              style={{width: '100%', padding: '12px', background: completedModules.includes('breach') ? '#059669' : 'rgba(255,255,255,0.2)', border: '2px solid rgba(255,255,255,0.3)', borderRadius: '8px', color: 'white', fontWeight: '700', cursor: completedModules.includes('breach') ? 'default' : 'pointer', fontSize: '14px'}}
            >
              {completedModules.includes('breach') ? '‚úì Completed' : '‚ñ∂Ô∏è Start Training'}
            </button>
          </div>
        </div>

        {/* Quiz completion message - removed fake quiz button */}
        {completedModules.length === 3 && (
          <div style={{marginTop: '24px', padding: '16px', background: '#f0fdf4', border: '2px solid #10b981', borderRadius: '12px', textAlign: 'center'}}>
            <div style={{fontSize: '32px', marginBottom: '8px'}}>üéâ</div>
            <p style={{margin: '0', color: '#059669', fontWeight: '700', fontSize: '16px'}}>
              All training modules completed! Great job maintaining HIPAA compliance.
            </p>
          </div>
        )}

        {/* HIPAA Reminders */}
        <div style={{marginTop: '30px'}}>
          <h3 style={{color: '#1f2937', marginBottom: '16px', fontSize: '18px'}}>üí° Daily HIPAA Reminders</h3>
          <div className="reminder-cards">
            <div className="reminder-card">
              <div style={{fontSize: '24px', marginBottom: '8px'}}>üîê</div>
              <strong style={{display: 'block', marginBottom: '6px', color: '#1f2937'}}>Lock Your Workstation</strong>
              <p style={{margin: '0', fontSize: '13px', color: '#6b7280', lineHeight: '1.5'}}>
                Always lock your computer (Windows + L) when stepping away, even for a moment. Unauthorized access is a violation.
              </p>
            </div>

            <div className="reminder-card">
              <div style={{fontSize: '24px', marginBottom: '8px'}}>‚úÖ</div>
              <strong style={{display: 'block', marginBottom: '6px', color: '#1f2937'}}>Verify Patient Identity</strong>
              <p style={{margin: '0', fontSize: '13px', color: '#6b7280', lineHeight: '1.5'}}>
                Use at least two identifiers (name + DOB/MRN) before accessing or disclosing any patient information.
              </p>
            </div>

            <div className="reminder-card">
              <div style={{fontSize: '24px', marginBottom: '8px'}}>üì±</div>
              <strong style={{display: 'block', marginBottom: '6px', color: '#1f2937'}}>Approved Channels Only</strong>
              <p style={{margin: '0', fontSize: '13px', color: '#6b7280', lineHeight: '1.5'}}>
                Use only approved fax, email, and messaging systems from the Directory. Never use personal devices for PHI.
              </p>
            </div>

            <div className="reminder-card">
              <div style={{fontSize: '24px', marginBottom: '8px'}}>üö®</div>
              <strong style={{display: 'block', marginBottom: '6px', color: '#1f2937'}}>Report Incidents Immediately</strong>
              <p style={{margin: '0', fontSize: '13px', color: '#6b7280', lineHeight: '1.5'}}>
                If you suspect a breach or violation, report it immediately. Early reporting minimizes harm and shows compliance.
              </p>
            </div>
          </div>
        </div>

              {/* Compliance Stats */}
              <div style={{marginTop: '24px', background: complianceScore >= 80 ? '#f0fdf4' : complianceScore >= 50 ? '#fef3c7' : '#fee2e2', padding: '16px', borderRadius: '12px', border: complianceScore >= 80 ? '2px solid #10b981' : complianceScore >= 50 ? '2px solid #f59e0b' : '2px solid #ef4444'}}>
                <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                  <div style={{fontSize: '32px'}}>{complianceScore >= 80 ? 'üèÜ' : complianceScore >= 50 ? '‚ö†Ô∏è' : '‚ùå'}</div>
                  <div>
                    <strong style={{display: 'block', color: complianceScore >= 80 ? '#059669' : complianceScore >= 50 ? '#d97706' : '#dc2626', fontSize: '16px'}}>Your Compliance Score: {complianceScore}%</strong>
                    <p style={{margin: '4px 0 0 0', fontSize: '13px', color: '#6b7280'}}>
                      {complianceScore >= 80 ? `Excellent! ${completedModules.length} of 3 modules completed.` : complianceScore >= 50 ? `Good progress! Complete more training to improve. (${completedModules.length}/3 modules done)` : `Training required! Complete the quizzes below to improve your score.`}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Assignment Modal */}
      {selectedAssignment && (
        <AssignmentModal
          assignment={selectedAssignment}
          onClose={() => setSelectedAssignment(null)}
          onSubmit={handleSubmitAssignment}
        />
      )}

      {/* Add Patient Modal */}
      {showAddPatient && (
        <AddPatientModal
          onClose={() => setShowAddPatient(false)}
          onSubmit={handleAddPatient}
        />
      )}

      {/* Edit Patient Modal */}
      {editingPatient && (
        <EditPatientModal
          patient={editingPatient}
          onClose={() => setEditingPatient(null)}
          onSubmit={handleEditPatient}
        />
      )}

      {/* Training Modal */}
      {activeTraining && (
        <TrainingModal
          module={activeTraining}
          onClose={() => setActiveTraining(null)}
          completedModules={completedModules}
          setCompletedModules={setCompletedModules}
          currentUsername={currentUsername}
        />
      )}
    </>
  );
};

// Render App
ReactDOM.render(<NurseDashboard />, document.getElementById('root'));
</script>
{% endraw %}
</body>
</html>